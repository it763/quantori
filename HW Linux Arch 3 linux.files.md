## HW Linux Arch 3 linux.files
В папке /var/ftp/ - есть подпапки пользователей (/var/ftp/ivan, /var/ftp/aleksei, etc.), куда они складывают свои файлы.
Есть пользователь и группа ftp-admin - они используются администратором ftp сервера, и он может управлять содержимым всех подпапок всех пользователей. При этом обычные пользователи могут управлять только своими файлами.
Начинающий администратор случайно поломал права на папки и файлы, а также сменил пользователей владельцев и групп владельцев у некоторых файлов. Вам предстоит починить и привести систему к рабочему состоянию.
Используя команды find, chown, chmod восстановите правильный порядок.  
  
Предлагаю следующую схему: для каждой папки пользователя пользователем-владельцем устанавливается сам пользователь (напр. ivan). Группой- владельцем - группа ftp-admin. Пользователю-владельцу и группе-владельцу даются полные права на папку.
Таким образом пользователь получает полный доступ к своей папке, ftp-admin получает доступ ко всем папкам. Дополнительно устанавливается  GUID, чтобы все вновь создаваемые файлы имель владельца группу ftp-admin.  
  
Устанавливаем группу-владельца для всех подпапок и файлов /var/ftp - ftp-admin  
**chown -R .ftp-admin /var/ftp**  
Выдаем группе ftp-admin полные права на подпапки и файлы /var/ftp  
**chmod -R g+rws /var/ftp**  
Устанавливаем GUID для папки, чтобы все вновь создаваемые файлы имели группу-владельца ftp-admin. Таким образом пользователь ftp-admin получает доступ ко всем подпапкам и файлам внутри /var/ftp  
**chmod -R g+s /var/ftp**  
Отбираем права у остальных.  
**chmod -R o-rwx /var/ftp**  
Получаем список имен папок (и соответственно пользователей, которые должны быть владельцами папок), выводим в файл names.txt  
**find /var/ftp  -type d | grep '/var/ftp/' |cut -d/ -f4 >names.txt**  
Получаем  
ivan  
petr  
…  
Пишем скрипт.  Для каждого имени в файле берем папку с соответствующим именем, присваиваем ей пользователя-владельца с этим именем, даем ему полные права на папку и то, что в ней.  
**#! /bin/bash  
for name in $(cat names.txt)  
do  
chown -R ${name} /var/ftp/${name}  
chmod -R u+rwx /var/ftp/${name}  
done**  
  
Делаем исполняемым   
**chmod +x script.sh**  
Запускаем  
**./script.sh**  
  
Либо все можно поместить в один скрипт:  
**#! /bin/bash  
chown -R .ftp-admin /var/ftp  
chmod -R g+rws /var/ftp  
chmod -R g+s /var/ftp  
chmod -R o-rwx /var/ftp  
for name in $(find /var/ftp  -type d | grep '/var/ftp/' |cut -d/ -f4)  
do  
chown -R ${name} /var/ftp/${name}  
chmod -R u+rwx /var/ftp/${name}  
done**  
  
В результате получаем:  
drwxrws---. 2 ivan ftp-admin  71 Jul  7 19:55 ivan  
drwxrws---. 2 petr ftp-admin   6 Jul  7 19:44 petr  






















